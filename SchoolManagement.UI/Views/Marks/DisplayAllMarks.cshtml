@model IEnumerable<SchoolManagement.Core.ViewModels.MarksDetailsDto>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />
<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}

<div class="container">
    <div class="table-responsive mt-4">
        <table id="marksTable" class="table table-striped table-hover table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Student Name</th>
                    <th>Academic Year</th>
                    <th>Class</th>
                    <th>Subject</th>
                    <th>Exam</th>
                    <th>Exam Type</th>
                    <th>Marks</th>
                    <th>Max Marks</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var mark in Model)
                {
                    var isPass = mark.Result == "Pass";
                    var percentage = (double)mark.MarksObtained / mark.MaxMarks * 100;
                    <tr class="@(isPass ? "" : "table-danger")">
                        <td>@mark.StudentFullName</td>
                        <td>@mark.AcademicYear</td>
                        <td>@mark.ClassName</td>
                        <td>@mark.SubjectName</td>
                        <td>@mark.ExamName</td>
                        <td>@mark.ExamTypeName</td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar @(isPass ? "bg-success" : "bg-danger")"
                                     role="progressbar"
                                     style="width: @percentage.ToString("F0")%;"
                                     aria-valuenow="@mark.MarksObtained"
                                     aria-valuemin="0"
                                     aria-valuemax="@mark.MaxMarks">
                                    @mark.MarksObtained
                                </div>
                            </div>
                        </td>
                        <td>@mark.MaxMarks</td>
                        <td>
                            <span class="badge @(isPass ? "bg-success" : "bg-danger")">
                                @mark.Result
                            </span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#marksTable').DataTable({
            "paging": true,
            "searching": true,
            "info": true,
            "responsive": true,
            "language": {
                "search": "Filter records:",
                "lengthMenu": "Show _MENU_ entries",
                "zeroRecords": "No matching records found",
                "info": "Showing _START_ to _END_ of _TOTAL_ entries"
            }
        });
    });
</script>
